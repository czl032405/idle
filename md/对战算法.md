# 对战算法

## 名词

1. baseProps 基础属性 

2. battleProps 战斗属性

3. equits 装备

4. passtiveSkills 被动属性



## 流程

### 初始化
1. character.baseProps => character.battleProps

2. character.equits[].apply(character) 修改 character.battleProps

3. character.equits[].apply(character) 修改 character.skills

4. character.skills => character.positiveSkills & character.passtiveSkills

5. character.passtiveSkills[].apply 修改 character.battleProps

6. character.passtiveSkills[].apply 修改 character.buffers

7. character.buffers[].apply(origin,receiver)

### 战斗循环
1. action =  min(character.buffers[].nextInterval,character.battleProps.nextinterval)

2. character.buffers[].nextInterval-=minInterval 

3. character.baseProps.nextInterval-=minInterval

2. if action == buffer 
    1. roundInfo = buffer.fire()
    2. buffer.times-1;
    3. buffer.times==0 && buffer.remove()
    4. engine.calRoundInfo

3. if action == character.attack
    0.  roundInfo = character.preAttack(defender)
    1. character.buffers[].onBeforeAttack(attacker)
    2. character.attack(roundInfo)
    3. character.buffers[].onAfterAttack(roundInfo)
    4. defender.buffers[].onBeforeDefend(roundInfo)
    5. defender.defend(roundInfo)
    6. defender.buffers[].onAfterDefend(roundInfo)
    7. engine.calRoundInfo

4. checkBattleOver == false && go to 1

5. checkBattleOver == true && end

### roundInfo
1. 从buffer.fire或character.preAttack产生
2. 经过各个行为发生数据变动
3. 在battle.js计算delay
4. 在batlle.js把roundinfo计算到character.battleProps