
# 开发笔记
## markdown
- 20170306
查询了各种文档基本确定后台运行的不可能。
但是，草案中却存在着serviceworker定时api，所以将来是可能的。
还是改用离线奖励经验和物品的方式

- 20170303
在battle.js中通过打印日志检测到程序在调用ajax并且返回后，在处理对战结果时暂停了。期间只有直接执行的代码和await settimeout。似乎直接在某句暂停了，并且在打开后继续了。
[fight vs]史莱姆 10:05:07
[fight end] 10:19:52

在sw.js中的脚本在锁屏后,甚至会暂停或者内存重置。

- 20170302
修改单页应用
修改页面样式
对战程序在长时间最小化锁屏后（10分钟左右）就会在某点停止运行
页面和js内存依然存在
ajax未显示错误
疑似while循环中在某处终止运行。
疑似js在无界面的情况继续执行至某处终止执行。界面和js在点击后恢复。

- 20170228
service worker + httpcaches 缓存
manifest 固定主屏幕
progressiv web app 技术走通
即使所有页面都从serviceworker直接返回，但是跳转仍然有卡顿感，需要改为单页应用。


## ToDoList
- 公式
- 内容
- 攻击
- 物品功能


## DraftList
- 物品价格波动
- 精炼系统

## milestone
- 1v1对战内核 20170120
- 完整处理对战请求 20170120
- 客户端界面到后台走通，已经可以玩 20170217



---------

## 架构
[对战引擎 + 数据层 -> 业务层] (内核) -> 服务端 -> 客户端

## 内核
*IDLE内核,包含对战引擎、业务层、数据层、参数配置*
1. engine
*对战引擎*
- 修复1v1对战bug 20170209
- 精简对战返回数据 20170209
- 1v1对战 20170120

2. action
*业务层*
* user
- 详情 20170206
- 创建 20170206
- 登录 20170206
* hero
- 创建角色 20170206
- 删除角色 20170207
- 选择角色 20170206
- 切换职业 20170206
- 配置技能 20170206
- 配置装备 20170206
- 学习职业 20170206
- 学习技能 20170206
- 发现怪物 20170207
- 对战 20170207
- 怪物掉落 
- 处理对战结果 20170207
- 掉落装备处理 20170207
- 掉落物品处理 20170207
- 掉落金钱处理 20170207
- 经验-》升级 20170207
- 升级-》属性更新 20170207
- 升级-》可学习技能更新 20170207
- 升级-》可学习职业更新 20170207
- 技能点处理
* admin
- 用户列表 20170206
- 用户封禁 20170206
- 角色列表 20170206


3. data
*数据层*
- 移除数据层逻辑，直接返回model 20170206 
- 数据库接入 20170122
- hero.js  20170123
- user.js 20170123

4. setting 
*参数配置*
* idle.json 20170207
放置idle内核的参数配置，如双倍经验，游戏名称
* exp.json 20170207
定义每级升级所需要经验值
* job.json 20170207
配置职业条件，升级加成
* map.json 20170207
配置地图的怪物出现概率，且不高于人物2级，进入地图条件
* monster.json  20170207
配置怪物名称、属性、技能、装备、掉落 
* skill.json  20170207
配置技能学习条件
* item.json 20170207
配置物品使用条件
* equit.json 20170207
配置装备使用条件



## 服务端
*负责参数验证，结果处理。直接对接IDLE.Action。* 
- 处理session store序列化持久层对象的问题 20170209
- 接口调通 20170208
- 持久层user、hero对象 存放在session 20170206
- 把服务端的逻辑抽象成action 放进内核 20170206
- 取消使用socket 20170206
- 静态资源md5  20170125
- 接口认证  20170125
- 自动登录 20170207
- 封禁处理 
- user 20170124
- hero 20170207
- admin 20170207


## 客户端
*前端，对接服务端*
- html imports + vue comps + bootstrap 搭建  20170125
- 接口测试页面 20170217
- 登录 20170217
- 用户-角色选择 20170217
- 对战 20170217
- 技能 20170220
- 职业 20170220
- 装备 20170220
- 物品 
- 地图 20170220



